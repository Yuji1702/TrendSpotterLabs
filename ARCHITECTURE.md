# TrendSpotter Labs - Website Architecture

## Overview

TrendSpotter Labs is a modern web application built with NestJS (backend) and vanilla JavaScript (frontend). The application provides analytics and reporting services with a contact form that integrates with Google Sheets for data storage.

---

## Technology Stack

### Backend
- **Framework**: NestJS (TypeScript-based Node.js framework)
- **Runtime**: Node.js v20.x+
- **Language**: TypeScript
- **API Style**: RESTful
- **External Integration**: Google Sheets API

### Frontend
- **HTML5**: Semantic markup
- **CSS3**: Custom styling with modern features
- **JavaScript**: Vanilla ES6+ (no frameworks)
- **Animation**: anime.js library
- **Build**: Served as static files by NestJS

---

## Project Structure

```
TrendSpotterLabs/
├── src/                          # Backend source code (TypeScript)
│   ├── main.ts                   # Application entry point
│   ├── app.module.ts             # Root module
│   ├── config/                   # Configuration files
│   │   └── google-sheets.config.ts  # Google Sheets credentials & settings
│   └── contact/                  # Contact feature module
│       ├── contact.module.ts     # Module definition
│       ├── contact.controller.ts # HTTP endpoints handler
│       ├── contact.service.ts    # Business logic & Google Sheets integration
│       └── dto/                  # Data Transfer Objects
│           └── create-contact.dto.ts  # Contact form validation schema
│
├── public/                       # Frontend static files
│   ├── index.html                # Main HTML page
│   ├── script.js                 # Frontend JavaScript
│   └── styles.css                # CSS styling
│
├── dist/                         # Compiled output (generated by build)
├── node_modules/                 # NPM dependencies
├── package.json                  # Node.js project configuration
├── tsconfig.json                 # TypeScript compiler configuration
├── nest-cli.json                 # NestJS CLI configuration
└── README.md                     # Project documentation
```

---

## Module Architecture

### 1. **Application Layer** (`src/main.ts`)

**Purpose**: Bootstrap and configure the NestJS application

**Responsibilities**:
- Create NestJS application instance
- Enable CORS for cross-origin requests
- Configure global validation pipes
- Start HTTP server on port 3000 (or PORT environment variable)

**Key Configurations**:
- CORS: Allows requests from any origin
- ValidationPipe: Automatically validates incoming requests against DTOs
- Global exception handling

---

### 2. **Root Module** (`src/app.module.ts`)

**Purpose**: Orchestrate all feature modules and global configurations

**Imports**:
- `ServeStaticModule`: Serves frontend files from `public/` directory
- `ContactModule`: Handles contact form functionality

**Functionality**:
- Serves static files at root path (`/`)
- Registers all feature modules
- Manages dependency injection container

---

### 3. **Contact Module** (`src/contact/`)

The Contact Module is a feature module that handles all contact form functionality.

#### 3.1 Contact Module (`contact.module.ts`)

**Purpose**: Define the Contact feature module

**Components**:
- `ContactController`: HTTP request handler
- `ContactService`: Business logic provider

#### 3.2 Contact Controller (`contact.controller.ts`)

**Purpose**: Handle HTTP requests for contact form submissions

**Endpoints**:
- `POST /api/contact/submit`: Submit contact form data

**Process Flow**:
1. Receives HTTP POST request
2. Validates request body against `CreateContactDto`
3. Delegates processing to `ContactService`
4. Returns JSON response to client

**Request Format**:
```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "message": "I need analytics services",
  "phone": "555-1234",       // optional
  "company": "ACME Corp"      // optional
}
```

**Response Format**:
```json
{
  "success": true,
  "message": "Data saved successfully.",
  "updatedRange": "LiveDB!A2:F2"
}
```

#### 3.3 Contact Service (`contact.service.ts`)

**Purpose**: Business logic and Google Sheets integration

**Responsibilities**:
- Initialize Google Sheets API client
- Generate serial numbers for submissions
- Append data to Google Sheets
- Handle errors gracefully

**Google Sheets Integration Flow**:
1. Authenticate using service account credentials
2. Query existing rows to calculate serial number
3. Format data: `[Serial, Name, Email, Phone, Company, Message]`
4. Append row to configured sheet range
5. Return success response with updated range

#### 3.4 Data Transfer Object (`dto/create-contact.dto.ts`)

**Purpose**: Define and validate contact form data structure

**Validation Rules**:
- `name`: Required, non-empty string
- `email`: Required, valid email format
- `message`: Required, non-empty string
- `phone`: Optional string
- `company`: Optional string

**Validation Library**: class-validator decorators

---

### 4. **Configuration Module** (`src/config/`)

#### 4.1 Google Sheets Config (`google-sheets.config.ts`)

**Purpose**: Store Google Sheets API credentials and settings

**Configuration Elements**:
- **Credentials**: Service account authentication details
  - Private key, client email, project ID
- **Spreadsheet ID**: Target Google Sheet identifier
- **Range**: Sheet name and column range (`LiveDB!A:F`)

**Security Note**: Credentials are hardcoded for simplicity. In production, use environment variables or secret management services.

---

### 5. **Frontend Layer** (`public/`)

#### 5.1 HTML (`index.html`)

**Purpose**: Single-page application structure

**Sections**:
1. **Header/Navigation**: Logo, mobile menu, nav links
2. **Hero**: Welcome section with animations
3. **Services**: Analytics offerings
4. **Tools**: Technologies used
5. **Outcomes**: Expected benefits
6. **Process**: Steps to get started
7. **Contact**: Form for lead generation
8. **Footer**: Copyright and links

#### 5.2 JavaScript (`script.js`)

**Purpose**: Frontend interactivity and animations

**Functionality Modules**:

1. **Navigation**
   - Mobile hamburger menu toggle
   - Smooth scrolling to sections
   - Active state management

2. **Animations** (using anime.js)
   - Hero entrance animations on page load
   - Continuous floating animations for decorative elements
   - Scroll-triggered reveal animations for sections
   - Navigation bar scroll effect

3. **Form Handling**
   - Client-side validation (name, email, message)
   - Email format validation with regex
   - AJAX submission to `/api/contact/submit`
   - Success/error feedback display
   - Visual feedback (shake on error)

**Animation Strategy**:
- Entrance animations: Staggered fade-in with translateY
- Scroll reveals: IntersectionObserver for performance
- Continuous loops: Subtle floating/pulsing effects

#### 5.3 Styles (`styles.css`)

**Purpose**: Visual presentation and responsive design

**Architecture**:
- Mobile-first responsive design
- CSS Grid and Flexbox layouts
- Custom CSS variables for theming
- Smooth transitions and hover effects
- Accessibility-friendly (proper contrast, focus states)

---

## Data Flow

### Contact Form Submission Flow

```
User fills form
    ↓
[Frontend Validation] (script.js)
    ↓
POST /api/contact/submit
    ↓
[NestJS Validation Pipe] (CreateContactDto)
    ↓
[Contact Controller] (contact.controller.ts)
    ↓
[Contact Service] (contact.service.ts)
    ↓
[Google Sheets API]
    ↓
Append data to LiveDB sheet
    ↓
Return success response
    ↓
[Frontend] Display confirmation message
```

### Request Lifecycle

1. **Frontend**: User interaction triggers event
2. **Client-side validation**: JavaScript validates input
3. **HTTP request**: Fetch API sends POST request
4. **CORS check**: NestJS validates origin (allows all)
5. **Route matching**: Matches `/api/contact/submit`
6. **Validation**: ValidationPipe validates against DTO
7. **Controller**: Receives validated data
8. **Service**: Processes business logic
9. **External API**: Google Sheets API call
10. **Response**: Returns JSON to frontend
11. **UI Update**: Display success/error message

---

## API Endpoints

### POST /api/contact/submit

**Description**: Submit a contact form

**Request Body**:
```typescript
{
  name: string;      // Required
  email: string;     // Required, valid email
  message: string;   // Required
  phone?: string;    // Optional
  company?: string;  // Optional
}
```

**Success Response** (200):
```json
{
  "success": true,
  "message": "Data saved successfully.",
  "updatedRange": "LiveDB!A2:F2"
}
```

**Error Response** (400/500):
```json
{
  "success": false,
  "error": "Error message"
}
```

---

## External Integrations

### Google Sheets API

**Purpose**: Store contact form submissions in a spreadsheet

**Authentication**: Service Account (OAuth 2.0)

**Permissions Required**: 
- `https://www.googleapis.com/auth/spreadsheets` (Read/Write access)

**Target Sheet Structure**:
| Column | Field       | Type   |
|--------|-------------|--------|
| A      | Serial      | Number |
| B      | Name        | String |
| C      | Email       | String |
| D      | Phone       | String |
| E      | Company     | String |
| F      | Message     | String |

**Operations**:
1. **Read**: Get row count for serial number
2. **Write**: Append new row with form data

---

## Development Workflow

### Development Mode
```bash
npm run start:dev
```
- Watches for file changes
- Auto-reloads on TypeScript changes
- Serves frontend at `http://localhost:3000`

### Production Build
```bash
npm run build
npm run start:prod
```
- Compiles TypeScript to JavaScript
- Outputs to `dist/` directory
- Runs optimized production build

### Linting
```bash
npm run lint
```
- Checks code style with ESLint
- Auto-fixes fixable issues

---

## Security Considerations

### Current Implementation
- Credentials hardcoded in source code
- CORS allows all origins
- No authentication on endpoints
- Service account has full sheet access

### Production Recommendations
1. **Environment Variables**: Move credentials to environment variables or secret management service (AWS Secrets Manager, Azure Key Vault)
2. **CORS**: Restrict to specific allowed origins
3. **Rate Limiting**: Implement rate limiting on API endpoints
4. **Input Sanitization**: Additional validation and sanitization
5. **HTTPS**: Enforce HTTPS in production
6. **Service Account Permissions**: Limit to specific sheets
7. **Monitoring**: Add logging and monitoring for API calls

---

## Scalability Considerations

### Current Architecture Limitations
- Single server instance
- Synchronous Google Sheets API calls
- No caching layer
- No queue for form submissions

### Scaling Recommendations
1. **Horizontal Scaling**: Deploy multiple instances behind load balancer
2. **Queue System**: Use Redis/RabbitMQ for async form processing
3. **Database**: Consider adding database for better query performance
4. **CDN**: Serve static files from CDN
5. **Caching**: Cache Google Sheets read operations
6. **API Gateway**: Add API gateway for rate limiting and authentication

---

## Testing

### Unit Tests
```bash
npm run test
```
- Tests individual modules and services
- Mock external dependencies

### End-to-End Tests
```bash
npm run test:e2e
```
- Tests complete request/response cycle
- Validates integration with external services

---

## Deployment

### Environment Variables
- `PORT`: HTTP server port (default: 3000)
- Consider adding: `GOOGLE_SHEETS_ID`, `GOOGLE_CREDENTIALS`, `CORS_ORIGIN`

### Build for Production
```bash
npm run build
```

### Run Production Server
```bash
npm run start:prod
```

### Docker Deployment (Recommended)
```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "run", "start:prod"]
```

---

## Troubleshooting

### Common Issues

**Issue**: Application won't start
- **Solution**: Check if port 3000 is available, verify Node.js version

**Issue**: Google Sheets API errors
- **Solution**: Verify service account credentials, check sheet permissions

**Issue**: Form submissions fail
- **Solution**: Check browser console for errors, verify API endpoint is reachable

**Issue**: CORS errors
- **Solution**: Ensure CORS is properly configured in `main.ts`

---

## Future Enhancements

### Planned Features
1. Email notifications on form submission
2. Admin dashboard for viewing submissions
3. Form submission analytics
4. Multi-language support
5. A/B testing framework
6. Integration with CRM systems

### Technical Improvements
1. Add comprehensive test coverage
2. Implement CI/CD pipeline
3. Add API documentation (Swagger/OpenAPI)
4. Implement proper logging system
5. Add performance monitoring
6. Migrate to database for better scalability

---

## Support and Maintenance

### Code Quality
- Follow TypeScript best practices
- Use ESLint for code consistency
- Write meaningful commit messages
- Keep dependencies up to date

### Documentation
- Update this document when architecture changes
- Document all API endpoints
- Maintain inline code comments
- Update README with new features

---

## Conclusion

The TrendSpotter Labs application follows a modular architecture with clear separation between frontend and backend concerns. The NestJS backend provides a robust, scalable foundation, while the frontend delivers a smooth user experience with modern animations and interactions. The integration with Google Sheets provides a simple yet effective data storage solution for contact form submissions.
